{"ast":null,"code":"var _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { handleGarageRaceStatusesHistory } from 'Storages/SessionStorage';\nimport { fetchCarDrive } from 'CONSTANTS/Axios';\nimport { deleteCar, newWinner, setSelectedCar, updateWinner } from 'store/modules/listReducer';\nimport styles from './GarageTableRow.module.scss';\nfunction UseGarageTableRow(carData) {\n  _s();\n  const dispatch = useDispatch();\n  const {\n    id\n  } = carData;\n  const {\n    selectedCar,\n    race,\n    winner,\n    winnersList\n  } = useSelector(store => store.list);\n  const [time, setTime] = useState(0);\n  const [raceStatus, setRaceStatus] = useState(handleGarageRaceStatusesHistory('getItem', {\n    key: id\n  }) || 'stopped');\n  const animationStyle = {\n    animation: `${styles.moveToEnd} ${time}s linear 4.2s forwards`\n  };\n  useEffect(() => {\n    handleGarageRaceStatusesHistory('update', {\n      key: id,\n      newValue: raceStatus != 'stopped' ? 'finished' : 'stopped'\n    });\n  }, [raceStatus]);\n  const handleStart = () => {\n    setRaceStatus('stopped');\n    setTimeout(() => {\n      setRaceStatus('started');\n      if ((selectedCar === null || selectedCar === void 0 ? void 0 : selectedCar.id) == id) dispatch(setSelectedCar(undefined));\n      fetchCarDrive(id, 'started').then(response => {\n        if (!(response !== null && response !== void 0 && response.isFailed)) {\n          const raceTime = response.distance / (response.velocity * 1500);\n          setTime(raceTime);\n        } else setRaceStatus('stopped');\n      });\n    }, 0);\n  };\n  const handleStop = () => {\n    fetchCarDrive(id, 'stopped');\n    setRaceStatus('stopped');\n  };\n  const toggleSelect = () => dispatch(setSelectedCar((selectedCar === null || selectedCar === void 0 ? void 0 : selectedCar.id) == id ? undefined : carData));\n  const handleDelete = () => dispatch(deleteCar(id));\n  const handleFinish = () => {\n    if (race && !winner) {\n      const lastWin = winnersList.find(car => car.id === id);\n      if (lastWin) dispatch(updateWinner({\n        ...lastWin,\n        time: time\n      }));else dispatch(newWinner({\n        ...carData,\n        time: time * 5\n      }));\n    }\n    ;\n    setRaceStatus('finished');\n  };\n  useEffect(() => {\n    if (race != 'finished') race ? handleStart() : handleStop();\n  }, [race]);\n  return {\n    handleStart,\n    handleStop,\n    toggleSelect,\n    handleDelete,\n    raceStatus,\n    animationStyle,\n    handleFinish\n  };\n}\n_s(UseGarageTableRow, \"0r/WzE2XsPEGfPoO22kS7Rnqnhs=\", false, function () {\n  return [useDispatch, useSelector];\n});\n_c = UseGarageTableRow;\nexport default UseGarageTableRow;\nvar _c;\n$RefreshReg$(_c, \"UseGarageTableRow\");","map":{"version":3,"names":["React","useState","useEffect","useDispatch","useSelector","handleGarageRaceStatusesHistory","fetchCarDrive","deleteCar","newWinner","setSelectedCar","updateWinner","styles","UseGarageTableRow","carData","_s","dispatch","id","selectedCar","race","winner","winnersList","store","list","time","setTime","raceStatus","setRaceStatus","key","animationStyle","animation","moveToEnd","newValue","handleStart","setTimeout","undefined","then","response","isFailed","raceTime","distance","velocity","handleStop","toggleSelect","handleDelete","handleFinish","lastWin","find","car","_c","$RefreshReg$"],"sources":["C:/Users/Admin/Documents/GitHub/Async-Race/src/components/commons/GarageTableRow/UseGarageTableRow.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\n\r\nimport { handleGarageRaceStatusesHistory } from 'Storages/SessionStorage';\r\nimport { fetchCarDrive } from 'CONSTANTS/Axios';\r\nimport { deleteCar, newWinner, setSelectedCar, updateWinner } from 'store/modules/listReducer';\r\n\r\nimport styles from './GarageTableRow.module.scss';\r\n\r\nfunction UseGarageTableRow( carData ) {\r\n   const dispatch = useDispatch();\r\n   const { id } = carData;\r\n   const { selectedCar, race, winner, winnersList } = useSelector( store => store.list );\r\n   const [ time, setTime ] = useState( 0 );\r\n   const [ raceStatus, setRaceStatus ] = useState( handleGarageRaceStatusesHistory( 'getItem', { key: id } ) || 'stopped' );\r\n   const animationStyle = { animation: `${ styles.moveToEnd } ${ time }s linear 4.2s forwards` };\r\n   useEffect( () => {\r\n      handleGarageRaceStatusesHistory( 'update', { key: id, newValue: raceStatus != 'stopped' ? 'finished' : 'stopped' } );\r\n   }, [ raceStatus ] );\r\n\r\n\r\n   const handleStart = () => {\r\n      setRaceStatus( 'stopped' );\r\n      setTimeout(() => {\r\n         setRaceStatus('started');\r\n         if ( selectedCar?.id == id ) dispatch( setSelectedCar( undefined ) );\r\n         fetchCarDrive( id, 'started' )\r\n         .then( response => {\r\n            if ( !response?.isFailed ) {\r\n               const raceTime = response.distance / ( response.velocity * 1500 );\r\n               setTime( raceTime );\r\n            } else setRaceStatus( 'stopped' );\r\n         });\r\n      }, 0);\r\n   };\r\n\r\n   const handleStop = () => {\r\n      fetchCarDrive( id, 'stopped' );\r\n      setRaceStatus( 'stopped' );\r\n   };\r\n   const toggleSelect = () => dispatch( setSelectedCar( selectedCar?.id == id ? undefined : carData ) );\r\n   const handleDelete = () => dispatch( deleteCar( id ) );\r\n   const handleFinish = () => {\r\n      if ( race && !winner ) {\r\n         const lastWin = winnersList.find( car => car.id === id );\r\n         if ( lastWin ) dispatch( updateWinner({ ...lastWin, time: time }));\r\n         else dispatch( newWinner({ ...carData, time: ( time * 5 ) }));\r\n      };\r\n      setRaceStatus( 'finished' );\r\n   };\r\n\r\n   useEffect( () => {\r\n      if ( race != 'finished' ) race ? handleStart() : handleStop();\r\n   }, [ race ] );\r\n   \r\n   return {\r\n      handleStart,\r\n      handleStop,\r\n      toggleSelect,\r\n      handleDelete,\r\n      raceStatus,\r\n      animationStyle,\r\n      handleFinish,\r\n   }\r\n}\r\n\r\nexport default UseGarageTableRow;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}