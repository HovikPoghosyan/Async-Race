{"ast":null,"code":"import _objectSpread from\"C:/Users/Admin/Documents/GitHub/Async-Race/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useDispatch,useSelector}from'react-redux';import{handleGarageRaceStatusesHistory}from'Storages/SessionStorage';import{fetchCarDrive}from'CONSTANTS/Axios';import{deleteCar,newWinner,setSelectedCar,updateWinner}from'store/modules/listReducer';import styles from'./GarageTableRow.module.scss';function UseGarageTableRow(carData){const dispatch=useDispatch();const{id}=carData;const{selectedCar,race,winner,winnersList}=useSelector(store=>store.list);const[time,setTime]=useState(0);const[raceStatus,setRaceStatus]=useState(handleGarageRaceStatusesHistory('getItem',{key:id})||'stopped');const animationStyle={animation:\"\".concat(styles.moveToEnd,\" \").concat(time,\"s linear 4.2s forwards\")};useEffect(()=>{handleGarageRaceStatusesHistory('update',{key:id,newValue:raceStatus!='stopped'?'finished':'stopped'});},[raceStatus]);const handleStart=()=>{setRaceStatus('stopped');setTimeout(()=>{setRaceStatus('started');if((selectedCar===null||selectedCar===void 0?void 0:selectedCar.id)==id)dispatch(setSelectedCar(undefined));fetchCarDrive(id,'started').then(response=>{if(!(response!==null&&response!==void 0&&response.isFailed)){const raceTime=response.distance/(response.velocity*1500);setTime(raceTime);}else setRaceStatus('stopped');});},0);};const handleStop=()=>{fetchCarDrive(id,'stopped');setRaceStatus('stopped');};const toggleSelect=()=>dispatch(setSelectedCar((selectedCar===null||selectedCar===void 0?void 0:selectedCar.id)==id?undefined:carData));const handleDelete=()=>dispatch(deleteCar(id));const handleFinish=()=>{if(race&&!winner){const lastWin=winnersList.find(car=>car.id===id);if(lastWin)dispatch(updateWinner(_objectSpread(_objectSpread({},lastWin),{},{time:Math.min(lastWin.time,(time*5).toFixed(3))})));else dispatch(newWinner(_objectSpread(_objectSpread({},carData),{},{time:(time*5).toFixed(3)})));};setRaceStatus('finished');};useEffect(()=>{if(race!='finished')race?handleStart():handleStop();},[race]);return{handleStart,handleStop,toggleSelect,handleDelete,raceStatus,animationStyle,handleFinish};}export default UseGarageTableRow;","map":{"version":3,"names":["React","useState","useEffect","useDispatch","useSelector","handleGarageRaceStatusesHistory","fetchCarDrive","deleteCar","newWinner","setSelectedCar","updateWinner","styles","UseGarageTableRow","carData","dispatch","id","selectedCar","race","winner","winnersList","store","list","time","setTime","raceStatus","setRaceStatus","key","animationStyle","animation","concat","moveToEnd","newValue","handleStart","setTimeout","undefined","then","response","isFailed","raceTime","distance","velocity","handleStop","toggleSelect","handleDelete","handleFinish","lastWin","find","car","_objectSpread","Math","min","toFixed"],"sources":["C:/Users/Admin/Documents/GitHub/Async-Race/src/components/commons/GarageTableRow/UseGarageTableRow.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\n\r\nimport { handleGarageRaceStatusesHistory } from 'Storages/SessionStorage';\r\nimport { fetchCarDrive } from 'CONSTANTS/Axios';\r\nimport { deleteCar, newWinner, setSelectedCar, updateWinner } from 'store/modules/listReducer';\r\n\r\nimport styles from './GarageTableRow.module.scss';\r\n\r\nfunction UseGarageTableRow( carData ) {\r\n   const dispatch = useDispatch();\r\n   const { id } = carData;\r\n   const { selectedCar, race, winner, winnersList } = useSelector( store => store.list );\r\n   const [ time, setTime ] = useState( 0 );\r\n   const [ raceStatus, setRaceStatus ] = useState( handleGarageRaceStatusesHistory( 'getItem', { key: id } ) || 'stopped' );\r\n   const animationStyle = { animation: `${ styles.moveToEnd } ${ time }s linear 4.2s forwards` };\r\n   useEffect( () => {\r\n      handleGarageRaceStatusesHistory( 'update', { key: id, newValue: raceStatus != 'stopped' ? 'finished' : 'stopped' } );\r\n   }, [ raceStatus ] );\r\n\r\n\r\n   const handleStart = () => {\r\n      setRaceStatus( 'stopped' );\r\n      setTimeout(() => {\r\n         setRaceStatus('started');\r\n         if ( selectedCar?.id == id ) dispatch( setSelectedCar( undefined ) );\r\n         fetchCarDrive( id, 'started' )\r\n         .then( response => {\r\n            if ( !response?.isFailed ) {\r\n               const raceTime = response.distance / ( response.velocity * 1500 );\r\n               setTime( raceTime );\r\n            } else setRaceStatus( 'stopped' );\r\n         });\r\n      }, 0);\r\n   };\r\n\r\n   const handleStop = () => {\r\n      fetchCarDrive( id, 'stopped' );\r\n      setRaceStatus( 'stopped' );\r\n   };\r\n   const toggleSelect = () => dispatch( setSelectedCar( selectedCar?.id == id ? undefined : carData ) );\r\n   const handleDelete = () => dispatch( deleteCar( id ) );\r\n   const handleFinish = () => {\r\n      if ( race && !winner ) {\r\n         const lastWin = winnersList.find( car => car.id === id );\r\n         if ( lastWin ) dispatch( updateWinner({ ...lastWin, time: Math.min( lastWin.time, ( time * 5 ).toFixed( 3 ) ) })); \r\n         else dispatch( newWinner({ ...carData, time: ( time * 5 ).toFixed( 3 ) }));\r\n      };\r\n      setRaceStatus( 'finished' );\r\n   };\r\n\r\n   useEffect( () => {\r\n      if ( race != 'finished' ) race ? handleStart() : handleStop();\r\n   }, [ race ] );\r\n   \r\n   return {\r\n      handleStart,\r\n      handleStop,\r\n      toggleSelect,\r\n      handleDelete,\r\n      raceStatus,\r\n      animationStyle,\r\n      handleFinish,\r\n   }\r\n}\r\n\r\nexport default UseGarageTableRow;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}