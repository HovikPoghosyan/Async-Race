{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport { fetchWinnersListPage, fetchNewWinner, fetchUpdateWinner, fetchDeleteWinner, fetchCarData } from 'CONSTANTS/Axios';\nimport { openWinnerPopup, setRace } from './garageListReducer';\nconst initialState = {\n  winnersList: [],\n  winner: undefined,\n  loading: false,\n  count: 0\n};\nconst newWinner = createAsyncThunk('winnersList/newWinner', async (carData, {\n  rejectWithValue,\n  dispatch\n}) => {\n  const response = await fetchNewWinner(carData);\n  if (response.isFailed) return rejectWithValue({\n    isFailed: true\n  });\n  dispatch(setRace('finished'));\n  dispatch(openWinnerPopup());\n  return response;\n});\nconst updateWinner = createAsyncThunk('winnersList/updateWinner', async (carData, {\n  rejectWithValue\n}) => {\n  const response = await fetchUpdateWinner(carData);\n  if (response.isFailed) return rejectWithValue({\n    isFailed: true\n  });\n  return response;\n});\nconst deleteWinner = createAsyncThunk('winnersList/deleteWinner', async (id, {\n  rejectWithValue\n}) => {\n  const response = await fetchDeleteWinner(id);\n  if (response.isFailed) return rejectWithValue({\n    isFailed: true\n  });\n  return response;\n});\nconst getWinnersListPage = createAsyncThunk('winnersList/getWinnersListPage', async (props, {\n  rejectWithValue,\n  getState\n}) => {\n  const response = await fetchWinnersListPage();\n  if (response.isFailed) return rejectWithValue({\n    isFailed: true\n  });\n  const {\n    garageList\n  } = getState().garageList;\n  const data = response.map(async winner => {\n    var _car, _car2;\n    let car = garageList.find(car => car.id === winner.id);\n    if (!car) car = await fetchCarData(winner.id);\n    return {\n      ...winner,\n      name: ((_car = car) === null || _car === void 0 ? void 0 : _car.name) || 'unknown',\n      color: ((_car2 = car) === null || _car2 === void 0 ? void 0 : _car2.color) || '#ccc'\n    };\n  });\n  return data;\n});\nconst winnersListReducer = createSlice({\n  name: 'winnersList',\n  initialState,\n  reducers: {\n    setWinnersList(state, {\n      payload\n    }) {\n      state.winnersList = payload;\n    },\n    setWinner(state, {\n      payload\n    }) {\n      state.winner = payload;\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(newWinner.pending, (state, {\n      meta\n    }) => {\n      state.winner = meta.arg;\n    }).addCase(newWinner.fulfilled, (state, {\n      meta\n    }) => {\n      state.winnersList.push({\n        id: meta.arg.id,\n        time: meta.arg.time,\n        wins: 1,\n        name: meta.arg.name || 'car',\n        color: meta.arg.color || '#ccc'\n      });\n    }).addCase(updateWinner.fulfilled, (state, {\n      meta\n    }) => {\n      state.winnersList = state.winnersList.map(winner => winner.id === meta.arg.id ? {\n        ...winner,\n        ...meta.arg\n      } : winner);\n    }).addCase(deleteWinner.fulfilled, (state, {\n      meta\n    }) => {\n      console.log('meta delet arg winner: ', meta.arg);\n      state.winnersList = state.winnersList.filter(winner => winner.id !== meta.arg);\n    }).addCase(getWinnersListPage.pending, state => {\n      state.loading = true;\n    }).addCase(getWinnersListPage.fulfilled, (state, {\n      payload\n    }) => {\n      state.winnersList = [...state.winnersList, ...payload.data].sort((carOne, carSecond) => carOne.id - carSecond.id);\n      state.count = payload.headers['x-total-count'];\n      state.loading = false;\n    }).addCase(getWinnersListPage.rejected, state => {\n      state.loading = false;\n    });\n  }\n});\nexport const {\n  setWinnersList,\n  setWinner\n} = winnersListReducer.actions;\nexport { updateWinner, getWinnersListPage, deleteWinner, newWinner };\nexport default winnersListReducer.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","fetchWinnersListPage","fetchNewWinner","fetchUpdateWinner","fetchDeleteWinner","fetchCarData","openWinnerPopup","setRace","initialState","winnersList","winner","undefined","loading","count","newWinner","carData","rejectWithValue","dispatch","response","isFailed","updateWinner","deleteWinner","id","getWinnersListPage","props","getState","garageList","data","map","_car","_car2","car","find","name","color","winnersListReducer","reducers","setWinnersList","state","payload","setWinner","extraReducers","builder","addCase","pending","meta","arg","fulfilled","push","time","wins","console","log","filter","sort","carOne","carSecond","headers","rejected","actions","reducer"],"sources":["C:/Users/Admin/Documents/GitHub/Async-Race/src/store/modules/winnersListReducer.ts"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport { fetchWinnersListPage, fetchNewWinner, fetchUpdateWinner, fetchDeleteWinner, fetchCarData } from 'CONSTANTS/Axios';\r\nimport type { RootState } from 'store/configureReduxStore';\r\nimport { Car, openWinnerPopup, setRace } from './garageListReducer';\r\n\r\nexport interface Winner {\r\n   id: number;\r\n   wins: number;\r\n   time: number;\r\n   name: string;\r\n   color: string;\r\n}\r\n\r\ninterface WinnersState {\r\n   winnersList: Winner[];\r\n   winner?: Partial<Winner>;\r\n   loading: boolean;\r\n   count: number;\r\n}\r\n\r\nconst initialState: WinnersState = {\r\n   winnersList: [],\r\n   winner: undefined,\r\n   loading: false,\r\n   count: 0,\r\n};\r\n\r\nconst newWinner = createAsyncThunk<Winner, Partial<Winner>, { state: RootState; rejectValue: { isFailed: boolean } }>(\r\n   'winnersList/newWinner',\r\n   async (carData, { rejectWithValue, dispatch }) => {\r\n      const response = await fetchNewWinner(carData);\r\n      if (response.isFailed) return rejectWithValue({ isFailed: true });\r\n      dispatch(setRace('finished'));\r\n      dispatch(openWinnerPopup());\r\n\r\n      return response;\r\n   }\r\n);\r\n\r\nconst updateWinner = createAsyncThunk<Winner, Winner, { state: RootState; rejectValue: { isFailed: boolean } }>(\r\n   'winnersList/updateWinner',\r\n   async (carData, { rejectWithValue }) => {\r\n      const response = await fetchUpdateWinner(carData);\r\n      if (response.isFailed) return rejectWithValue({ isFailed: true });\r\n\r\n      return response;\r\n   }\r\n);\r\n\r\nconst deleteWinner = createAsyncThunk<number, number, { state: RootState; rejectValue: { isFailed: boolean } }>(\r\n   'winnersList/deleteWinner',\r\n   async (id, { rejectWithValue }) => {\r\n      const response = await fetchDeleteWinner(id);\r\n      if (response.isFailed) return rejectWithValue({ isFailed: true });\r\n\r\n      return response;\r\n   }\r\n);\r\n\r\nconst getWinnersListPage = createAsyncThunk<any, number, { state: RootState; rejectValue: { isFailed: boolean; errorMessage: string } }>(\r\n   'winnersList/getWinnersListPage',\r\n   async (props, { rejectWithValue, getState }) => {\r\n      const response = await fetchWinnersListPage();\r\n      if (response.isFailed) return rejectWithValue({ isFailed: true });\r\n      const { garageList } = getState().garageList;\r\n\r\n      const data = response.map(async (winner: Winner) => {\r\n         let car = garageList.find((car: Car) => car.id === winner.id);\r\n         if( !car ) car = await fetchCarData( winner.id );\r\n   \r\n         return { ...winner, name: car?.name || 'unknown', color: car?.color || '#ccc' };\r\n      });\r\n      \r\n\r\n      return data;\r\n   }\r\n);\r\n\r\nconst winnersListReducer = createSlice({\r\n   name: 'winnersList',\r\n   initialState,\r\n   reducers: {\r\n      setWinnersList(state, { payload }) {\r\n         state.winnersList = payload;\r\n      },\r\n      setWinner(state, { payload }) {\r\n         state.winner = payload;\r\n      },\r\n   },\r\n   extraReducers: (builder) => {\r\n      builder\r\n         .addCase(newWinner.pending, (state, { meta }) => {\r\n            state.winner = meta.arg;\r\n         })\r\n         .addCase(newWinner.fulfilled, (state, { meta }) => {\r\n            state.winnersList.push({\r\n               id: meta.arg.id!,\r\n               time: meta.arg.time!,\r\n               wins: 1,\r\n               name: meta.arg.name || 'car',\r\n               color: meta.arg.color || '#ccc',\r\n            });\r\n         })\r\n         .addCase(updateWinner.fulfilled, (state, { meta }) => {\r\n            state.winnersList = state.winnersList.map((winner) => (winner.id === meta.arg.id ? { ...winner, ...meta.arg } : winner));\r\n         })\r\n         .addCase(deleteWinner.fulfilled, (state, { meta }) => {\r\n            console.log('meta delet arg winner: ', meta.arg);\r\n            state.winnersList = state.winnersList.filter((winner) => winner.id !== meta.arg);\r\n         })\r\n         .addCase(getWinnersListPage.pending, (state) => {\r\n            state.loading = true;\r\n         })\r\n         .addCase(getWinnersListPage.fulfilled, (state, { payload }) => {\r\n            state.winnersList = [\r\n               ...state.winnersList,\r\n               ...payload.data,\r\n            ].sort(( carOne, carSecond) => carOne.id - carSecond.id);\r\n            state.count = payload.headers['x-total-count'];\r\n            state.loading = false;\r\n         })\r\n         .addCase(getWinnersListPage.rejected, (state) => {\r\n            state.loading = false;\r\n         });\r\n   },\r\n});\r\n\r\nexport const { setWinnersList, setWinner } = winnersListReducer.actions;\r\nexport { updateWinner, getWinnersListPage, deleteWinner, newWinner };\r\nexport default winnersListReducer.reducer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}