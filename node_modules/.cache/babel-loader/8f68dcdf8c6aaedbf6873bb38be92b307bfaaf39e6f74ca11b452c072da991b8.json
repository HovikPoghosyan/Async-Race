{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { useAppDispatch, useAppSelector } from 'store/hooks/hooks';\nimport { fetchCarEngineMode, fetchCarDrive } from 'CONSTANTS/Axios';\nimport { deleteCar, setSelectedCar, setRace, openWinnerPopup } from 'store/modules/garageListReducer';\nimport { newWinner, updateWinner } from 'store/modules/winnersListReducer';\nimport styles from './GarageTableRow.module.scss';\nconst getAnimationStyle = (raceStatus, time) => ({\n  animationName: styles.moveToEnd,\n  animationDuration: `${time}s`,\n  animationTimingFunction: 'linear',\n  animationDelay: '4.2s',\n  animationFillMode: 'forwards',\n  animationPlayState: raceStatus === 'brokenEngine' ? 'paused' : 'running'\n});\nconst startCar = (id, selectedCar, dispatch, setRaceStatus, setTime) => {\n  setRaceStatus('stopped');\n  setTimeout(() => {\n    setRaceStatus('started');\n    if ((selectedCar === null || selectedCar === void 0 ? void 0 : selectedCar.id) === id) dispatch(setSelectedCar(undefined));\n    fetchCarEngineMode(id, 'started').then(response => {\n      if (!(response !== null && response !== void 0 && response.isFailed)) {\n        const raceTime = response.distance / (response.velocity * 500);\n        setTimeout(() => {\n          fetchCarDrive(id).then(res => {\n            if (res !== null && res !== void 0 && res.isFailed && res.status === 500) {\n              setRaceStatus('brokenEngine');\n            }\n          });\n        }, 4200);\n        setTime(raceTime);\n      } else setRaceStatus('stopped');\n    });\n  }, 0);\n};\nconst stopCar = (id, setRaceStatus) => {\n  fetchCarEngineMode(id, 'stopped');\n  setRaceStatus('stopped');\n};\nfunction UseGarageTableRow(carData) {\n  _s();\n  const dispatch = useAppDispatch();\n  const {\n    id\n  } = carData;\n  const {\n    selectedCar,\n    race\n  } = useAppSelector(store => store.garageList);\n  const {\n    winnersList,\n    winner\n  } = useAppSelector(store => store.winnersList);\n  const [time, setTime] = useState(0);\n  const [raceStatus, setRaceStatus] = useState('stopped');\n  const animationStyle = getAnimationStyle(raceStatus, time);\n  const handleStart = () => startCar(id, selectedCar, dispatch, setRaceStatus, setTime);\n  const handleStop = () => stopCar(id, setRaceStatus);\n  const handleFinish = () => {\n    if (race == 'started' && !winner) {\n      const lastWin = winnersList.find(winner => winner.id === id);\n      const timeNewValue = Number((time * 5).toFixed(3));\n      if (lastWin) {\n        dispatch(updateWinner({\n          ...lastWin,\n          wins: lastWin.wins + 1,\n          time: Math.min(lastWin.time, timeNewValue)\n        }));\n        dispatch(setRace('finished'));\n        dispatch(openWinnerPopup());\n      } else dispatch(newWinner({\n        ...carData,\n        time: timeNewValue\n      }));\n    }\n    setRaceStatus('finished');\n  };\n  const toggleSelect = () => dispatch(setSelectedCar((selectedCar === null || selectedCar === void 0 ? void 0 : selectedCar.id) == id ? undefined : carData));\n  const handleDelete = () => dispatch(deleteCar(id));\n  useEffect(() => {\n    if (race && race != 'finished' && race !== raceStatus) race === 'started' ? handleStart() : handleStop();\n  }, [race]);\n  return {\n    handleStart,\n    handleStop,\n    toggleSelect,\n    handleDelete,\n    raceStatus,\n    animationStyle,\n    handleFinish\n  };\n}\n_s(UseGarageTableRow, \"+SE9w3dXpdJkBRdQnVri82/WLhU=\", false, function () {\n  return [useAppDispatch, useAppSelector, useAppSelector];\n});\n_c = UseGarageTableRow;\nexport default UseGarageTableRow;\nvar _c;\n$RefreshReg$(_c, \"UseGarageTableRow\");","map":{"version":3,"names":["useState","useEffect","useAppDispatch","useAppSelector","fetchCarEngineMode","fetchCarDrive","deleteCar","setSelectedCar","setRace","openWinnerPopup","newWinner","updateWinner","styles","getAnimationStyle","raceStatus","time","animationName","moveToEnd","animationDuration","animationTimingFunction","animationDelay","animationFillMode","animationPlayState","startCar","id","selectedCar","dispatch","setRaceStatus","setTime","setTimeout","undefined","then","response","isFailed","raceTime","distance","velocity","res","status","stopCar","UseGarageTableRow","carData","_s","race","store","garageList","winnersList","winner","animationStyle","handleStart","handleStop","handleFinish","lastWin","find","timeNewValue","Number","toFixed","wins","Math","min","toggleSelect","handleDelete","_c","$RefreshReg$"],"sources":["C:/Users/Admin/Documents/GitHub/Async-Race/src/components/commons/GarageTableRow/UseGarageTableRow.ts"],"sourcesContent":["import React, { FC, useState, useEffect, CSSProperties } from 'react';\r\nimport { useAppDispatch, useAppSelector } from 'store/hooks/hooks';\r\n\r\nimport { fetchCarEngineMode, fetchCarDrive } from 'CONSTANTS/Axios';\r\nimport { deleteCar, setSelectedCar, setRace, openWinnerPopup } from 'store/modules/garageListReducer';\r\nimport { newWinner, updateWinner, Winner } from 'store/modules/winnersListReducer';\r\nimport { AppDispatch } from 'store/configureReduxStore';\r\n\r\nimport styles from './GarageTableRow.module.scss';\r\n\r\ninterface CarData {\r\n   id: number;\r\n   name: string;\r\n   color: string;\r\n}\r\n\r\ntype RaceStatus = 'stopped' | 'started' | 'finished' | 'brokenEngine';\r\n\r\ninterface UseGarageTableRowReturn {\r\n   handleStart: () => void;\r\n   handleStop: () => void;\r\n   toggleSelect: () => void;\r\n   handleDelete: () => void;\r\n   raceStatus: RaceStatus;\r\n   animationStyle: CSSProperties;\r\n   handleFinish: () => void;\r\n}\r\n\r\nconst getAnimationStyle = (raceStatus: string, time: number): CSSProperties => ({\r\n   animationName: styles.moveToEnd,\r\n   animationDuration: `${time}s`,\r\n   animationTimingFunction: 'linear',\r\n   animationDelay: '4.2s',\r\n   animationFillMode: 'forwards',\r\n   animationPlayState: raceStatus === 'brokenEngine' ? 'paused' : 'running',\r\n});\r\n\r\nconst startCar = (\r\n   id: number,\r\n   selectedCar: CarData | undefined,\r\n   dispatch: AppDispatch,\r\n   setRaceStatus: React.Dispatch<React.SetStateAction<RaceStatus>>,\r\n   setTime: React.Dispatch<React.SetStateAction<number>>\r\n) => {\r\n   setRaceStatus('stopped');\r\n   setTimeout(() => {\r\n      setRaceStatus('started');\r\n      if (selectedCar?.id === id) dispatch(setSelectedCar(undefined));\r\n\r\n      fetchCarEngineMode(id, 'started').then((response) => {\r\n         if (!response?.isFailed) {\r\n            const raceTime = response.distance / (response.velocity * 500);\r\n            setTimeout(() => {\r\n               fetchCarDrive(id).then((res) => {\r\n                  if (res?.isFailed && res.status === 500) {\r\n                     setRaceStatus('brokenEngine');\r\n                  }\r\n               });\r\n            }, 4200);\r\n            setTime(raceTime);\r\n         } else setRaceStatus('stopped');\r\n      });\r\n   }, 0);\r\n};\r\n\r\nconst stopCar = (id: number, setRaceStatus: React.Dispatch<React.SetStateAction<RaceStatus>>) => {\r\n   fetchCarEngineMode(id, 'stopped');\r\n   setRaceStatus('stopped');\r\n};\r\n\r\nfunction UseGarageTableRow(carData: CarData): UseGarageTableRowReturn {\r\n   const dispatch = useAppDispatch();\r\n   const { id } = carData;\r\n   const { selectedCar, race } = useAppSelector((store) => store.garageList);\r\n   const { winnersList, winner } = useAppSelector((store) => store.winnersList);\r\n   const [time, setTime] = useState<number>(0);\r\n   const [raceStatus, setRaceStatus] = useState<RaceStatus>('stopped');\r\n   const animationStyle: CSSProperties = getAnimationStyle(raceStatus, time);\r\n\r\n   const handleStart = () => startCar(id, selectedCar, dispatch, setRaceStatus, setTime);\r\n   const handleStop = () => stopCar(id, setRaceStatus);\r\n   const handleFinish = () => {\r\n      if (race == 'started' && !winner) {\r\n         const lastWin = winnersList.find((winner: Winner) => winner.id === id);\r\n         const timeNewValue = Number((time * 5).toFixed(3));\r\n         if (lastWin) {\r\n            dispatch(\r\n               updateWinner({\r\n                  ...lastWin,\r\n                  wins: lastWin.wins + 1,\r\n                  time: Math.min(lastWin.time, timeNewValue),\r\n               })\r\n            );\r\n            dispatch(setRace('finished'));\r\n            dispatch(openWinnerPopup());\r\n         } else dispatch(newWinner({ ...carData, time: timeNewValue }));\r\n      }\r\n      setRaceStatus('finished');\r\n   };\r\n   const toggleSelect = () => dispatch(setSelectedCar(selectedCar?.id == id ? undefined : carData));\r\n   const handleDelete = () => dispatch(deleteCar(id));\r\n   useEffect(() => {\r\n      if (race && race != 'finished' && race !== raceStatus) race === 'started' ? handleStart() : handleStop();\r\n   }, [race]);\r\n\r\n   return { handleStart, handleStop, toggleSelect, handleDelete, raceStatus, animationStyle, handleFinish };\r\n}\r\n\r\nexport default UseGarageTableRow;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}