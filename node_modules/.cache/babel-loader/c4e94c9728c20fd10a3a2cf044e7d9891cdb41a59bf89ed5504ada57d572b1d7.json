{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { useAppDispatch, useAppSelector } from 'store/hooks/hooks';\nimport { handleGarageRaceStatusesHistory } from 'Storages/SessionStorage';\nimport { fetchCarEngineMode, fetchCarDrive } from 'CONSTANTS/Axios';\nimport { deleteCar, newWinner, setSelectedCar, updateWinner } from 'store/modules/listReducer';\nimport styles from './GarageTableRow.module.scss';\nconst getAnimationStyle = (raceStatus, time) => ({\n  animationName: styles.moveToEnd,\n  animationDuration: `${time}s`,\n  animationTimingFunction: 'linear',\n  animationDelay: '4.2s',\n  animationFillMode: 'forwards',\n  animationPlayState: raceStatus === 'brokenEngine' ? 'paused' : 'running'\n});\nconst startCar = (id, selectedCar, dispatch, setRaceStatus, setTime) => {\n  setRaceStatus('stopped');\n  setTimeout(() => {\n    setRaceStatus('started');\n    if ((selectedCar === null || selectedCar === void 0 ? void 0 : selectedCar.id) === id) dispatch(setSelectedCar(undefined));\n    fetchCarEngineMode(id, 'started').then(response => {\n      if (!(response !== null && response !== void 0 && response.isFailed)) {\n        const raceTime = response.distance / (response.velocity * 500);\n        setTimeout(() => {\n          fetchCarDrive(id).then(res => {\n            if (res !== null && res !== void 0 && res.isFailed && res.status === 500) {\n              setRaceStatus('brokenEngine');\n            }\n          });\n        }, 4200);\n        setTime(raceTime);\n      } else setRaceStatus('stopped');\n    });\n  }, 0);\n};\nconst stopCar = (id, setRaceStatus) => {\n  fetchCarEngineMode(id, 'stopped');\n  setRaceStatus('stopped');\n};\nfunction UseGarageTableRow(carData) {\n  _s();\n  const dispatch = useAppDispatch();\n  const {\n    id\n  } = carData;\n  const {\n    selectedCar,\n    race,\n    winner,\n    winnersList\n  } = useAppSelector(store => store.list);\n  const [time, setTime] = useState(0);\n  const [raceStatus, setRaceStatus] = useState(handleGarageRaceStatusesHistory('getItem', {\n    key: id\n  }) || 'stopped');\n  const animationStyle = getAnimationStyle(raceStatus, time);\n  useEffect(() => {\n    if (raceStatus !== 'started') {\n      handleGarageRaceStatusesHistory('update', {\n        key: id,\n        newValue: raceStatus\n      });\n    }\n  }, [raceStatus]);\n  const handleStart = () => startCar(id, selectedCar, dispatch, setRaceStatus, setTime);\n  const handleStop = () => stopCar(id, setRaceStatus);\n  const handleFinish = () => {\n    if (race && !winner) {\n      const lastWin = winnersList.find(car => car.id === id);\n      const timeNewValue = Number((time * 5).toFixed(3));\n      if (lastWin) dispatch(updateWinner({\n        ...lastWin,\n        time: Math.min(lastWin.time, timeNewValue)\n      }));else dispatch(newWinner({\n        ...carData,\n        time: timeNewValue\n      }));\n    }\n    setRaceStatus('finished');\n  };\n  const toggleSelect = () => dispatch(setSelectedCar((selectedCar === null || selectedCar === void 0 ? void 0 : selectedCar.id) == id ? undefined : carData));\n  const handleDelete = () => dispatch(deleteCar(id));\n  useEffect(() => {\n    if (race && race != 'finished') race === 'started' ? handleStart() : handleStop();\n  }, [race]);\n  return {\n    handleStart,\n    handleStop,\n    toggleSelect,\n    handleDelete,\n    raceStatus,\n    animationStyle,\n    handleFinish\n  };\n}\n_s(UseGarageTableRow, \"eNe3FXVE5Cu1lcjjE3vVmGtOa5g=\", false, function () {\n  return [useAppDispatch, useAppSelector];\n});\n_c = UseGarageTableRow;\nexport default UseGarageTableRow;\n\n// const handleStart = () => {\n//       setRaceStatus('stopped');\n//       setTimeout(() => {\n//          setRaceStatus('started');\n//          if (selectedCar?.id == id) dispatch(setSelectedCar(undefined));\n//          fetchCarEngineMode(id, 'started').then((response) => {\n//             if (!response?.isFailed) {\n//                const raceTime = response.distance / (response.velocity * 500);\n//                setTimeout(\n//                   () =>\n//                      fetchCarDrive(id).then((response) => {\n//                         if (response?.isFailed && response.status == 500) {\n//                            setRaceStatus('brokenEngine');\n//                         }\n//                      }),\n//                   4200\n//                );\n\n//                setTime(raceTime);\n//             } else setRaceStatus('stopped');\n//          });\n//       }, 0);\n//    };\n//    const handleStop = () => {\n//       fetchCarEngineMode(id, 'stopped');\n//       setRaceStatus('stopped');\n//    };\n// const handleFinish = () => {\n//       if (race && !winner) {\n//          const lastWin = winnersList.find((car) => car.id === id);\n//          const timeNewValue = Number((time * 5).toFixed(3));\n//          if (lastWin)\n//             dispatch(\n//                updateWinner({\n//                   ...lastWin,\n//                   time: Math.min(lastWin.time, timeNewValue),\n//                })\n//             );\n//          else dispatch(newWinner({ ...carData, time: timeNewValue }));\n//       }\n//       setRaceStatus('finished');\n//    };\nvar _c;\n$RefreshReg$(_c, \"UseGarageTableRow\");","map":{"version":3,"names":["useState","useEffect","useAppDispatch","useAppSelector","handleGarageRaceStatusesHistory","fetchCarEngineMode","fetchCarDrive","deleteCar","newWinner","setSelectedCar","updateWinner","styles","getAnimationStyle","raceStatus","time","animationName","moveToEnd","animationDuration","animationTimingFunction","animationDelay","animationFillMode","animationPlayState","startCar","id","selectedCar","dispatch","setRaceStatus","setTime","setTimeout","undefined","then","response","isFailed","raceTime","distance","velocity","res","status","stopCar","UseGarageTableRow","carData","_s","race","winner","winnersList","store","list","key","animationStyle","newValue","handleStart","handleStop","handleFinish","lastWin","find","car","timeNewValue","Number","toFixed","Math","min","toggleSelect","handleDelete","_c","$RefreshReg$"],"sources":["C:/Users/Admin/Documents/GitHub/Async-Race/src/components/commons/GarageTableRow/UseGarageTableRow.ts"],"sourcesContent":["import React, { FC, useState, useEffect, CSSProperties } from 'react';\nimport { useAppDispatch, useAppSelector } from 'store/hooks/hooks';\n\nimport { handleGarageRaceStatusesHistory } from 'Storages/SessionStorage';\nimport { fetchCarEngineMode, fetchCarDrive } from 'CONSTANTS/Axios';\nimport { deleteCar, newWinner, setSelectedCar, updateWinner } from 'store/modules/listReducer';\nimport { AppDispatch } from 'store/configureReduxStore';\n\nimport styles from './GarageTableRow.module.scss';\n\ninterface CarData {\n   id: number;\n   name: string;\n   color: string;\n}\n\ntype RaceStatus = 'stopped' | 'started' | 'finished' | 'brokenEngine';\n\ninterface UseGarageTableRowReturn {\n   handleStart: () => void;\n   handleStop: () => void;\n   toggleSelect: () => void;\n   handleDelete: () => void;\n   raceStatus: RaceStatus;\n   animationStyle: CSSProperties;\n   handleFinish: () => void;\n}\n\nconst getAnimationStyle = (raceStatus: string, time: number): CSSProperties => ({\n   animationName: styles.moveToEnd,\n   animationDuration: `${time}s`,\n   animationTimingFunction: 'linear',\n   animationDelay: '4.2s',\n   animationFillMode: 'forwards',\n   animationPlayState: raceStatus === 'brokenEngine' ? 'paused' : 'running',\n});\n\nconst startCar = (\n   id: number,\n   selectedCar: CarData | undefined,\n   dispatch: AppDispatch,\n   setRaceStatus: React.Dispatch<React.SetStateAction<RaceStatus>>,\n   setTime: React.Dispatch<React.SetStateAction<number>>\n) => {\n   setRaceStatus('stopped');\n   setTimeout(() => {\n      setRaceStatus('started');\n      if (selectedCar?.id === id) dispatch(setSelectedCar(undefined));\n\n      fetchCarEngineMode(id, 'started').then((response) => {\n         if (!response?.isFailed) {\n            const raceTime = response.distance / (response.velocity * 500);\n            setTimeout(() => {\n               fetchCarDrive(id).then((res) => {\n                  if (res?.isFailed && res.status === 500) {\n                     setRaceStatus('brokenEngine');\n                  }\n               });\n            }, 4200);\n            setTime(raceTime);\n         } else setRaceStatus('stopped');\n      });\n   }, 0);\n};\n\nconst stopCar = (id: number, setRaceStatus: React.Dispatch<React.SetStateAction<RaceStatus>>) => {\n   fetchCarEngineMode(id, 'stopped');\n   setRaceStatus('stopped');\n};\n\nfunction UseGarageTableRow(carData: CarData): UseGarageTableRowReturn {\n   const dispatch = useAppDispatch();\n   const { id } = carData;\n   const { selectedCar, race, winner, winnersList } = useAppSelector((store) => store.list);\n   const [time, setTime] = useState<number>(0);\n   const [raceStatus, setRaceStatus] = useState<RaceStatus>(\n      (handleGarageRaceStatusesHistory('getItem', { key: id }) as RaceStatus) || 'stopped'\n   );\n   const animationStyle: CSSProperties = getAnimationStyle(raceStatus, time);\n   useEffect(() => {\n      if (raceStatus !== 'started') {\n         handleGarageRaceStatusesHistory('update', { key: id, newValue: raceStatus });\n      }\n   }, [raceStatus]);\n\n   const handleStart = () => startCar(id, selectedCar, dispatch, setRaceStatus, setTime);\n   const handleStop = () => stopCar(id, setRaceStatus);\n   const handleFinish = () => {\n      if (race && !winner) {\n         const lastWin = winnersList.find((car) => car.id === id);\n         const timeNewValue = Number((time * 5).toFixed(3));\n         if (lastWin)\n            dispatch(\n               updateWinner({\n                  ...lastWin,\n                  time: Math.min(lastWin.time, timeNewValue),\n               })\n            );\n         else dispatch(newWinner({ ...carData, time: timeNewValue }));\n      }\n      setRaceStatus('finished');\n   };\n   const toggleSelect = () => dispatch(setSelectedCar(selectedCar?.id == id ? undefined : carData));\n   const handleDelete = () => dispatch(deleteCar(id));\n   useEffect(() => {\n      if (race && race != 'finished') race === 'started' ? handleStart() : handleStop();\n   }, [race]);\n\n   return { handleStart, handleStop, toggleSelect, handleDelete, raceStatus, animationStyle, handleFinish };\n}\n\nexport default UseGarageTableRow;\n\n// const handleStart = () => {\n//       setRaceStatus('stopped');\n//       setTimeout(() => {\n//          setRaceStatus('started');\n//          if (selectedCar?.id == id) dispatch(setSelectedCar(undefined));\n//          fetchCarEngineMode(id, 'started').then((response) => {\n//             if (!response?.isFailed) {\n//                const raceTime = response.distance / (response.velocity * 500);\n//                setTimeout(\n//                   () =>\n//                      fetchCarDrive(id).then((response) => {\n//                         if (response?.isFailed && response.status == 500) {\n//                            setRaceStatus('brokenEngine');\n//                         }\n//                      }),\n//                   4200\n//                );\n\n//                setTime(raceTime);\n//             } else setRaceStatus('stopped');\n//          });\n//       }, 0);\n//    };\n//    const handleStop = () => {\n//       fetchCarEngineMode(id, 'stopped');\n//       setRaceStatus('stopped');\n//    };\n// const handleFinish = () => {\n//       if (race && !winner) {\n//          const lastWin = winnersList.find((car) => car.id === id);\n//          const timeNewValue = Number((time * 5).toFixed(3));\n//          if (lastWin)\n//             dispatch(\n//                updateWinner({\n//                   ...lastWin,\n//                   time: Math.min(lastWin.time, timeNewValue),\n//                })\n//             );\n//          else dispatch(newWinner({ ...carData, time: timeNewValue }));\n//       }\n//       setRaceStatus('finished');\n//    };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}